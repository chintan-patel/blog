<!DOCTYPE html>
<html>
<head>
  <title>url.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../doc-style.css" />
  <script src="../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../", thisFile = "core/server/config/url.js", defaultSidebar = true;
  </script>
  <script src="../../../doc-script.js"></script>
  <script src="../../../fileSearch.js"></script>
  <link rel="stylesheet" href="../../../fileSearch.css" />
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h2">
        <a href="#setconfig">setConfig</a>
      </div>
      <div class="heading h2">
        <a href="#createurl">createUrl</a>
      </div>
      <div class="heading h2">
        <a href="#urlpathforpost">urlPathForPost</a>
      </div>
      <div class="heading h2">
        <a href="#urlfor">urlFor</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>url.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
<p>Contains all path information to be used throughout
the codebase.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">moment</span>            <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;moment&#39;</span><span class="p">),</span>
    <span class="nx">_</span>                 <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;lodash&#39;</span><span class="p">),</span>
    <span class="nx">ghostConfig</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>@TODO: unify this with routes.apiBaseUrl</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">apiPath</span> <span class="o">=</span> <span class="s1">&#39;/ghost/api/v0.1&#39;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="setconfig">
  <h2>
    <a href="#setconfig" name="setconfig" class="pilcrow">&#182;</a>
    setConfig
  </h2>
</div>


<p>Simple utility function to allow
passing of the ghostConfig
object here to be used locally
to ensure clean dependency graph
(i.e. no circular dependencies).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">setConfig</span><span class="p">(</span><span class="nx">config</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ghostConfig</span> <span class="o">=</span> <span class="nx">config</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">getBaseUrl</span><span class="p">(</span><span class="nx">secure</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="nx">secure</span> <span class="o">&amp;&amp;</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">urlSSL</span><span class="p">)</span> <span class="o">?</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">urlSSL</span> <span class="o">:</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">urlJoin</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">),</span>
        <span class="nx">prefixDoubleSlash</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">subdir</span> <span class="o">=</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">paths</span><span class="p">.</span><span class="nx">subdir</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\//g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
        <span class="nx">subdirRegex</span><span class="p">,</span>
        <span class="nx">url</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>Remove empty item at the beginning</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>Handle schemeless protocols</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;//&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">prefixDoubleSlash</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>join the elements using a slash</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">url</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>Fix multiple slashes</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(^|[^:])\/\/+/g</span><span class="p">,</span> <span class="s1">&#39;$1/&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>Put the double slash back at the beginning if this was a schemeless protocol</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">prefixDoubleSlash</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^\//</span><span class="p">,</span> <span class="s1">&#39;//&#39;</span><span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>Deduplicate subdirectory</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">subdir</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">subdirRegex</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="nx">subdir</span> <span class="o">+</span> <span class="s1">&#39;\/&#39;</span> <span class="o">+</span> <span class="nx">subdir</span><span class="p">);</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">subdirRegex</span><span class="p">,</span> <span class="nx">subdir</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">url</span><span class="p">;</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="createurl">
  <h2>
    <a href="#createurl" name="createurl" class="pilcrow">&#182;</a>
    createUrl
  </h2>
</div>


<p>Simple url creation from a given path
Ensures that our urls contain the subdirectory if there is one
And are correctly formatted as either relative or absolute
Usage:
createUrl('/', true) -> <a href='http://my-ghost-blog.com/'>http://my-ghost-blog.com/</a>
E.g. /blog/ subdir
createUrl('/welcome-to-ghost/') -> /blog/welcome-to-ghost/
Parameters:
- urlPath - string which must start and end with a slash
- absolute (optional, default:false) - boolean whether or not the url should be absolute
- secure (optional, default:false) - boolean whether or not to use urlSSL or url config
Returns:
 - a URL which always ends with a slash</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">createUrl</span><span class="p">(</span><span class="nx">urlPath</span><span class="p">,</span> <span class="nx">absolute</span><span class="p">,</span> <span class="nx">secure</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">urlPath</span> <span class="o">=</span> <span class="nx">urlPath</span> <span class="o">||</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
    <span class="nx">absolute</span> <span class="o">=</span> <span class="nx">absolute</span> <span class="o">||</span> <span class="kc">false</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">base</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>create base of url, always ends without a slash</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">absolute</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">base</span> <span class="o">=</span> <span class="nx">getBaseUrl</span><span class="p">(</span><span class="nx">secure</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">base</span> <span class="o">=</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">paths</span><span class="p">.</span><span class="nx">subdir</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">urlJoin</span><span class="p">(</span><span class="nx">base</span><span class="p">,</span> <span class="nx">urlPath</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="urlpathforpost">
  <h2>
    <a href="#urlpathforpost" name="urlpathforpost" class="pilcrow">&#182;</a>
    urlPathForPost
  </h2>
</div>


<p>Always sync
Creates the url path for a post, given a post and a permalink
Parameters:
- post - a json object representing a post</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">urlPathForPost</span><span class="p">(</span><span class="nx">post</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">output</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
        <span class="nx">permalinks</span> <span class="o">=</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">theme</span><span class="p">.</span><span class="nx">permalinks</span><span class="p">,</span>
        <span class="nx">tags</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nx">year</span><span class="o">:</span>   <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">published_at</span><span class="p">).</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;YYYY&#39;</span><span class="p">);</span> <span class="p">},</span>
            <span class="nx">month</span><span class="o">:</span>  <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">published_at</span><span class="p">).</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;MM&#39;</span><span class="p">);</span> <span class="p">},</span>
            <span class="nx">day</span><span class="o">:</span>    <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">moment</span><span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">published_at</span><span class="p">).</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;DD&#39;</span><span class="p">);</span> <span class="p">},</span>
            <span class="nx">author</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">post</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">slug</span><span class="p">;</span> <span class="p">},</span>
            <span class="nx">slug</span><span class="o">:</span>   <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">post</span><span class="p">.</span><span class="nx">slug</span><span class="p">;</span> <span class="p">},</span>
            <span class="nx">id</span><span class="o">:</span>     <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">post</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span> <span class="p">}</span>
        <span class="p">};</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">post</span><span class="p">.</span><span class="nx">page</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">output</span> <span class="o">+=</span> <span class="s1">&#39;/:slug/&#39;</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">output</span> <span class="o">+=</span> <span class="nx">permalinks</span><span class="p">;</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>replace tags like :slug or :year with actual values</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">output</span> <span class="o">=</span> <span class="nx">output</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/(:[a-z]+)/g</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">has</span><span class="p">(</span><span class="nx">tags</span><span class="p">,</span> <span class="nx">match</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">tags</span><span class="p">[</span><span class="nx">match</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">)]();</span>
        <span class="p">}</span>
    <span class="p">});</span>

    <span class="k">return</span> <span class="nx">output</span><span class="p">;</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="urlfor">
  <h2>
    <a href="#urlfor" name="urlfor" class="pilcrow">&#182;</a>
    urlFor
  </h2>
</div>


<p>Synchronous url creation for a given context
Can generate a url for a named path, given path, or known object (post)
Determines what sort of context it has been given, and delegates to the correct generation method,
Finally passing to createUrl, to ensure any subdirectory is honoured, and the url is absolute if needed
Usage:
urlFor('home', true) -> <a href='http://my-ghost-blog.com/'>http://my-ghost-blog.com/</a>
E.g. /blog/ subdir
urlFor({relativeUrl: '/my-static-page/'}) -> /blog/my-static-page/
E.g. if post object represents welcome post, and slugs are set to standard
urlFor('post', {...}) -> /welcome-to-ghost/
E.g. if post object represents welcome post, and slugs are set to date
urlFor('post', {...}) -> /2014/01/01/welcome-to-ghost/
Parameters:
- context - a string, or json object describing the context for which you need a url
- data (optional) - a json object containing data needed to generate a url
- absolute (optional, default:false) - boolean whether or not the url should be absolute
This is probably not the right place for this, but it's the best place for now</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">urlFor</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="nx">absolute</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">urlPath</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
        <span class="nx">secure</span><span class="p">,</span> <span class="nx">imagePathRe</span><span class="p">,</span>
        <span class="nx">knownObjects</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;post&#39;</span><span class="p">,</span> <span class="s1">&#39;tag&#39;</span><span class="p">,</span> <span class="s1">&#39;author&#39;</span><span class="p">,</span> <span class="s1">&#39;image&#39;</span><span class="p">,</span> <span class="s1">&#39;nav&#39;</span><span class="p">],</span> <span class="nx">baseUrl</span><span class="p">,</span>
        <span class="nx">hostname</span><span class="p">,</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>this will become really big</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">knownPaths</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">home</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span>
        <span class="nx">rss</span><span class="o">:</span> <span class="s1">&#39;/rss/&#39;</span><span class="p">,</span>
        <span class="nx">api</span><span class="o">:</span> <span class="nx">apiPath</span><span class="p">,</span>
        <span class="nx">sitemap_xsl</span><span class="o">:</span> <span class="s1">&#39;/sitemap.xsl&#39;</span>
    <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>Make data properly optional</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isBoolean</span><span class="p">(</span><span class="nx">data</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">absolute</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
        <span class="nx">data</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Can pass 'secure' flag in either context or data arg</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">secure</span> <span class="o">=</span> <span class="p">(</span><span class="nx">context</span> <span class="o">&amp;&amp;</span> <span class="nx">context</span><span class="p">.</span><span class="nx">secure</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">data</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">secure</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">context</span><span class="p">.</span><span class="nx">relativeUrl</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">urlPath</span> <span class="o">=</span> <span class="nx">context</span><span class="p">.</span><span class="nx">relativeUrl</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">knownObjects</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>trying to create a url for an object</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">context</span> <span class="o">===</span> <span class="s1">&#39;post&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">post</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">urlPath</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">post</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
            <span class="nx">secure</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">secure</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">context</span> <span class="o">===</span> <span class="s1">&#39;tag&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">urlPath</span> <span class="o">=</span> <span class="nx">urlJoin</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">routeKeywords</span><span class="p">.</span><span class="nx">tag</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">slug</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>
            <span class="nx">secure</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">tag</span><span class="p">.</span><span class="nx">secure</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">context</span> <span class="o">===</span> <span class="s1">&#39;author&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">author</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">urlPath</span> <span class="o">=</span> <span class="nx">urlJoin</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">routeKeywords</span><span class="p">.</span><span class="nx">author</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">slug</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">);</span>
            <span class="nx">secure</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">secure</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">context</span> <span class="o">===</span> <span class="s1">&#39;image&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">image</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">urlPath</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">image</span><span class="p">;</span>
            <span class="nx">imagePathRe</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">paths</span><span class="p">.</span><span class="nx">subdir</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">paths</span><span class="p">.</span><span class="nx">imagesRelPath</span><span class="p">);</span>
            <span class="nx">absolute</span> <span class="o">=</span> <span class="nx">imagePathRe</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">image</span><span class="p">)</span> <span class="o">?</span> <span class="nx">absolute</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
            <span class="nx">secure</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">image</span><span class="p">.</span><span class="nx">secure</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">absolute</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>Remove the sub-directory from the URL because ghostConfig will add it back.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="nx">urlPath</span> <span class="o">=</span> <span class="nx">urlPath</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s1">&#39;^&#39;</span> <span class="o">+</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">paths</span><span class="p">.</span><span class="nx">subdir</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
                <span class="nx">baseUrl</span> <span class="o">=</span> <span class="nx">getBaseUrl</span><span class="p">(</span><span class="nx">secure</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
                <span class="nx">urlPath</span> <span class="o">=</span> <span class="nx">baseUrl</span> <span class="o">+</span> <span class="nx">urlPath</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="nx">urlPath</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">context</span> <span class="o">===</span> <span class="s1">&#39;nav&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">.</span><span class="nx">nav</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">urlPath</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">nav</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
            <span class="nx">baseUrl</span> <span class="o">=</span> <span class="nx">getBaseUrl</span><span class="p">(</span><span class="nx">secure</span><span class="p">);</span>
            <span class="nx">hostname</span> <span class="o">=</span> <span class="nx">baseUrl</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;//&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">paths</span><span class="p">.</span><span class="nx">subdir</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">urlPath</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">hostname</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span>
                <span class="o">&amp;&amp;</span> <span class="nx">urlPath</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">hostname</span><span class="p">)</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span>
                <span class="o">&amp;&amp;</span> <span class="nx">urlPath</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;mailto:&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>make link relative to account for possible
mismatch in http/https etc, force absolute
do not do so if link is a subdomain of blog url</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="nx">urlPath</span> <span class="o">=</span> <span class="nx">urlPath</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="nx">hostname</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">urlPath</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">urlPath</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">urlPath</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="nx">absolute</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>other objects are recognised but not yet supported</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">context</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="nx">_</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">knownPaths</span><span class="p">),</span> <span class="nx">context</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>trying to create a url for a named path</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">urlPath</span> <span class="o">=</span> <span class="nx">knownPaths</span><span class="p">[</span><span class="nx">context</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>This url already has a protocol so is likely an external url to be returned
or it is an alternative scheme, protocol-less, or an anchor-only path</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">urlPath</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">urlPath</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;://&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span> <span class="o">||</span> <span class="nx">urlPath</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^(\/\/|#|[a-zA-Z0-9\-]+:)/</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">urlPath</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">createUrl</span><span class="p">(</span><span class="nx">urlPath</span><span class="p">,</span> <span class="nx">absolute</span><span class="p">,</span> <span class="nx">secure</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">apiUrl</span><span class="p">()</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>@TODO unify this with urlFor</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">url</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">forceAdminSSL</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="p">(</span><span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">urlSSL</span> <span class="o">||</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">url</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^.*?:\/\//g</span><span class="p">,</span> <span class="s1">&#39;https://&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">urlSSL</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">urlSSL</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^.*?:\/\//g</span><span class="p">,</span> <span class="s1">&#39;https://&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^https:/</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">url</span> <span class="o">=</span> <span class="nx">ghostConfig</span><span class="p">.</span><span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^.*?:\/\//g</span><span class="p">,</span> <span class="s1">&#39;//&#39;</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">url</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/$/</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">apiPath</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">setConfig</span> <span class="o">=</span> <span class="nx">setConfig</span><span class="p">;</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">urlJoin</span> <span class="o">=</span> <span class="nx">urlJoin</span><span class="p">;</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">urlFor</span> <span class="o">=</span> <span class="nx">urlFor</span><span class="p">;</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">urlPathForPost</span> <span class="o">=</span> <span class="nx">urlPathForPost</span><span class="p">;</span>
<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">apiUrl</span> <span class="o">=</span> <span class="nx">apiUrl</span><span class="p">;</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
