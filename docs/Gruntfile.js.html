<!DOCTYPE html>
<html>
<head>
  <title>Gruntfile.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "", thisFile = "Gruntfile.js", defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>
  <script src="fileSearch.js"></script>
  <link rel="stylesheet" href="fileSearch.css" />
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#task%20automation%20for%20ghost">Task automation for Ghost</a>
      </div>
      <div class="heading h2">
        <a href="#grunt%20configuration">Grunt configuration</a>
      </div>
      <div class="heading h4">
        <a href="#load%20all%20grunt%20tasks">Load all grunt tasks</a>
      </div>
      <div class="heading h4">
        <a href="#common%20paths%20used%20by%20tasks">Common paths used by tasks</a>
      </div>
      <div class="heading h3">
        <a href="#grunt-contrib-watch">grunt-contrib-watch</a>
      </div>
      <div class="heading h3">
        <a href="#grunt-express-server">grunt-express-server</a>
      </div>
      <div class="heading h3">
        <a href="#grunt-contrib-jshint">grunt-contrib-jshint</a>
      </div>
      <div class="heading h3">
        <a href="#grunt-mocha-cli">grunt-mocha-cli</a>
      </div>
      <div class="heading h4">
        <a href="#all%20unit%20tests">All Unit tests</a>
      </div>
      <div class="heading h5">
        <a href="#groups%20of%20unit%20tests">Groups of unit tests</a>
      </div>
      <div class="heading h4">
        <a href="#all%20integration%20tests">All Integration tests</a>
      </div>
      <div class="heading h5">
        <a href="#model%20integration%20tests">Model integration tests</a>
      </div>
      <div class="heading h5">
        <a href="#api%20integration%20tests">API integration tests</a>
      </div>
      <div class="heading h4">
        <a href="#all%20route%20tests">All Route tests</a>
      </div>
      <div class="heading h4">
        <a href="#all%20module%20tests">All Module tests</a>
      </div>
      <div class="heading h3">
        <a href="#grunt-mocha-istanbul">grunt-mocha-istanbul</a>
      </div>
      <div class="heading h3">
        <a href="#grunt-bg-shell">grunt-bg-shell</a>
      </div>
      <div class="heading h3">
        <a href="#grunt-shell">grunt-shell</a>
      </div>
      <div class="heading h4">
        <a href="#run%20bower%20install">Run bower install</a>
      </div>
      <div class="heading h3">
        <a href="#grunt-docker">grunt-docker</a>
      </div>
      <div class="heading h3">
        <a href="#grunt-contrib-clean">grunt-contrib-clean</a>
      </div>
      <div class="heading h3">
        <a href="#grunt-contrib-compress">grunt-contrib-compress</a>
      </div>
      <div class="heading h3">
        <a href="#grunt-update-submodules">grunt-update-submodules</a>
      </div>
      <div class="heading h2">
        <a href="#utilities">Utilities</a>
      </div>
      <div class="heading h3">
        <a href="#spawn%20casper.js">Spawn Casper.js</a>
      </div>
      <div class="heading h1">
        <a href="#custom%20tasks">Custom Tasks</a>
      </div>
      <div class="heading h3">
        <a href="#help">Help</a>
      </div>
      <div class="heading h3">
        <a href="#documentation">Documentation</a>
      </div>
      <div class="heading h2">
        <a href="#testing">Testing</a>
      </div>
      <div class="heading h4">
        <a href="#set%20test%20env%20(utility%20task)">Set Test Env (Utility Task)</a>
      </div>
      <div class="heading h4">
        <a href="#ensure%20config%20(utility%20task)">Ensure Config (Utility Task)</a>
      </div>
      <div class="heading h4">
        <a href="#reset%20database%20to%20%22new%22%20state%20(utility%20task)">Reset Database to "New" state (Utility Task)</a>
      </div>
      <div class="heading h3">
        <a href="#validate">Validate</a>
      </div>
      <div class="heading h3">
        <a href="#test-all">Test-All</a>
      </div>
      <div class="heading h3">
        <a href="#lint">Lint</a>
      </div>
      <div class="heading h3">
        <a href="#test-setup%20*(utility)(">test-setup *(utility)(</a>
      </div>
      <div class="heading h3">
        <a href="#unit%20tests%20(sub%20task)">Unit Tests (sub task)</a>
      </div>
      <div class="heading h3">
        <a href="#integration%20tests%20(sub%20task)">Integration tests (sub task)</a>
      </div>
      <div class="heading h3">
        <a href="#route%20tests%20(sub%20task)">Route tests (sub task)</a>
      </div>
      <div class="heading h3">
        <a href="#module%20tests%20(sub%20task)">Module tests (sub task)</a>
      </div>
      <div class="heading h3">
        <a href="#ember%20unit%20tests%20(sub%20task)">Ember unit tests (sub task)</a>
      </div>
      <div class="heading h3">
        <a href="#functional%20tests%20(sub%20task)">Functional tests (sub task)</a>
      </div>
      <div class="heading h3">
        <a href="#functional%20tests%20for%20the%20setup%20process">Functional tests for the setup process</a>
      </div>
      <div class="heading h3">
        <a href="#coverage">Coverage</a>
      </div>
      <div class="heading h4">
        <a href="#master%20warning%20(utility%20task)">Master Warning (Utility Task)</a>
      </div>
      <div class="heading h3">
        <a href="#build%20about%20page%20(utility%20task)">Build About Page (Utility Task)</a>
      </div>
      <div class="heading h2">
        <a href="#building%20assets">Building assets</a>
      </div>
      <div class="heading h3">
        <a href="#init%20assets">Init assets</a>
      </div>
      <div class="heading h3">
        <a href="#basic%20asset%20building">Basic Asset Building</a>
      </div>
      <div class="heading h3">
        <a href="#default%20asset%20build">Default asset build</a>
      </div>
      <div class="heading h3">
        <a href="#production%20assets">Production assets</a>
      </div>
      <div class="heading h3">
        <a href="#live%20reload">Live reload</a>
      </div>
      <div class="heading h3">
        <a href="#release">Release</a>
      </div>
      <div class="heading h4">
        <a href="#build%20file%20patterns">Build File Patterns</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
<div class="pilwrap" id="task%20automation%20for%20ghost">
  <h1>
    <a href="#task%20automation%20for%20ghost" name="task%20automation%20for%20ghost" class="pilcrow">&#182;</a>
    Task automation for Ghost
  </h1>
</div>


<p>Run various tasks when developing for and working with Ghost.</p>

<p><strong>Usage instructions:</strong> can be found in the <a href="#custom%20tasks">Custom Tasks</a> section or by running <code>grunt --help</code>.</p>

<p><strong>Debug tip:</strong> If you have any problems with any Grunt tasks, try running them with the <code>--verbose</code> command</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">_</span>              <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;lodash&#39;</span><span class="p">),</span>
    <span class="nx">chalk</span>          <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;chalk&#39;</span><span class="p">),</span>
    <span class="nx">fs</span>             <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs-extra&#39;</span><span class="p">),</span>
    <span class="nx">moment</span>         <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;moment&#39;</span><span class="p">),</span>
    <span class="nx">getTopContribs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;top-gh-contribs&#39;</span><span class="p">),</span>
    <span class="nx">path</span>           <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">),</span>
    <span class="nx">Promise</span>        <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;bluebird&#39;</span><span class="p">),</span>
    <span class="nx">request</span>        <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;request&#39;</span><span class="p">),</span>

    <span class="nx">escapeChar</span>     <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">platform</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^win/</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;^&#39;</span> <span class="o">:</span> <span class="s1">&#39;\\&#39;</span><span class="p">,</span>
    <span class="nx">cwd</span>            <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/( |\(|\))/g</span><span class="p">,</span> <span class="nx">escapeChar</span> <span class="o">+</span> <span class="s1">&#39;$1&#39;</span><span class="p">),</span>
    <span class="nx">buildDirectory</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">cwd</span><span class="p">,</span> <span class="s1">&#39;.build&#39;</span><span class="p">),</span>
    <span class="nx">distDirectory</span>  <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">cwd</span><span class="p">,</span> <span class="s1">&#39;.dist&#39;</span><span class="p">),</span>
    <span class="nx">mochaPath</span>      <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">cwd</span> <span class="o">+</span> <span class="s1">&#39;/node_modules/grunt-mocha-cli/node_modules/mocha/bin/mocha&#39;</span><span class="p">),</span>
    <span class="nx">emberPath</span>      <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">cwd</span> <span class="o">+</span> <span class="s1">&#39;/core/client/node_modules/.bin/ember&#39;</span><span class="p">),</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grunt%20configuration">
  <h2>
    <a href="#grunt%20configuration" name="grunt%20configuration" class="pilcrow">&#182;</a>
    Grunt configuration
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>

    <span class="nx">configureGrunt</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">grunt</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="load%20all%20grunt%20tasks">
  <h4>
    <a href="#load%20all%20grunt%20tasks" name="load%20all%20grunt%20tasks" class="pilcrow">&#182;</a>
    Load all grunt tasks
  </h4>
</div>


<p>Find all of the task which start with <code>grunt-</code> and load them, rather than explicitly declaring them all</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;matchdep&#39;</span><span class="p">).</span><span class="nx">filterDev</span><span class="p">([</span><span class="s1">&#39;grunt-*&#39;</span><span class="p">,</span> <span class="s1">&#39;!grunt-cli&#39;</span><span class="p">]).</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">loadNpmTasks</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">cfg</span> <span class="o">=</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="common%20paths%20used%20by%20tasks">
  <h4>
    <a href="#common%20paths%20used%20by%20tasks" name="common%20paths%20used%20by%20tasks" class="pilcrow">&#182;</a>
    Common paths used by tasks
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">paths</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">build</span><span class="o">:</span> <span class="nx">buildDirectory</span><span class="p">,</span>
                <span class="nx">releaseBuild</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">buildDirectory</span><span class="p">,</span> <span class="s1">&#39;release&#39;</span><span class="p">),</span>
                <span class="nx">dist</span><span class="o">:</span> <span class="nx">distDirectory</span><span class="p">,</span>
                <span class="nx">releaseDist</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">distDirectory</span><span class="p">,</span> <span class="s1">&#39;release&#39;</span><span class="p">)</span>
            <span class="p">},</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>Standard build type, for when we have nightlies again.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">buildType</span><span class="o">:</span> <span class="s1">&#39;Build&#39;</span><span class="p">,</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>Load package.json so that we can create correctly versioned releases.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">pkg</span><span class="o">:</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">readJSON</span><span class="p">(</span><span class="s1">&#39;package.json&#39;</span><span class="p">),</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grunt-contrib-watch">
  <h3>
    <a href="#grunt-contrib-watch" name="grunt-contrib-watch" class="pilcrow">&#182;</a>
    grunt-contrib-watch
  </h3>
</div>


<p>Watch files and livereload in the browser during development.
See the <a href="#live%20reload">grunt dev</a> task for how this is used.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">watch</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">livereload</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">files</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s1">&#39;content/themes/casper/assets/css/*.css&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;content/themes/casper/assets/js/*.js&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;core/built/assets/*.js&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;core/client/dist/index.html&#39;</span>
                    <span class="p">],</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">livereload</span><span class="o">:</span> <span class="kc">true</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nx">express</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">files</span><span class="o">:</span>  <span class="p">[</span><span class="s1">&#39;core/ghost-server.js&#39;</span><span class="p">,</span> <span class="s1">&#39;core/server/**/*.js&#39;</span><span class="p">],</span>
                    <span class="nx">tasks</span><span class="o">:</span>  <span class="p">[</span><span class="s1">&#39;express:dev&#39;</span><span class="p">],</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">spawn</span><span class="o">:</span> <span class="kc">false</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nx">csscomb</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">files</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/client/app/styles/**/*.css&#39;</span><span class="p">],</span>
                    <span class="nx">tasks</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;shell:csscombfix&#39;</span><span class="p">],</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">livereload</span><span class="o">:</span> <span class="kc">true</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grunt-express-server">
  <h3>
    <a href="#grunt-express-server" name="grunt-express-server" class="pilcrow">&#182;</a>
    grunt-express-server
  </h3>
</div>


<p>Start a Ghost expess server for use in development and testing</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">express</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">script</span><span class="o">:</span> <span class="s1">&#39;index.js&#39;</span><span class="p">,</span>
                    <span class="nx">output</span><span class="o">:</span> <span class="s1">&#39;Ghost is running&#39;</span>
                <span class="p">},</span>

                <span class="nx">dev</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{}</span>
                <span class="p">},</span>
                <span class="nx">test</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">node_env</span><span class="o">:</span> <span class="s1">&#39;testing&#39;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grunt-contrib-jshint">
  <h3>
    <a href="#grunt-contrib-jshint" name="grunt-contrib-jshint" class="pilcrow">&#182;</a>
    grunt-contrib-jshint
  </h3>
</div>


<p>Linting rules, run as part of <code>grunt validate</code>. See <a href="#validate">grunt validate</a> and its subtasks for
more information.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">jshint</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">jshintrc</span><span class="o">:</span> <span class="kc">true</span>
                <span class="p">},</span>

                <span class="nx">client</span><span class="o">:</span> <span class="p">[</span>
                    <span class="s1">&#39;core/client/**/*.js&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;!core/client/node_modules/**/*.js&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;!core/client/bower_components/**/*.js&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;!core/client/tmp/**/*.js&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;!core/client/dist/**/*.js&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;!core/client/vendor/**/*.js&#39;</span>
                <span class="p">],</span>

                <span class="nx">server</span><span class="o">:</span> <span class="p">[</span>
                    <span class="s1">&#39;*.js&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;!config*.js&#39;</span><span class="p">,</span> <span class="c1">// note: i added this, do we want this linted?</span>
                    <span class="s1">&#39;core/*.js&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;core/server/**/*.js&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;core/test/**/*.js&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;!core/test/coverage/**&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;!core/shared/vendor/**/*.js&#39;</span>
                <span class="p">]</span>
            <span class="p">},</span>

            <span class="nx">jscs</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">config</span><span class="o">:</span> <span class="kc">true</span>
                <span class="p">},</span>

                <span class="nx">client</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">config</span><span class="o">:</span> <span class="s1">&#39;core/client/.jscsrc&#39;</span>
                    <span class="p">},</span>

                    <span class="nx">files</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">src</span><span class="o">:</span> <span class="p">[</span>
                            <span class="s1">&#39;core/client/**/*.js&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;!core/client/node_modules/**/*.js&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;!core/client/bower_components/**/*.js&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;!core/client/tests/**/*.js&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;!core/client/tmp/**/*.js&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;!core/client/dist/**/*.js&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;!core/client/vendor/**/*.js&#39;</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">},</span>

                <span class="nx">client_tests</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">config</span><span class="o">:</span> <span class="s1">&#39;core/client/tests/.jscsrc&#39;</span>
                    <span class="p">},</span>

                    <span class="nx">files</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">src</span><span class="o">:</span> <span class="p">[</span>
                            <span class="s1">&#39;core/client/tests/**/*.js&#39;</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">},</span>

                <span class="nx">server</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">files</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">src</span><span class="o">:</span> <span class="p">[</span>
                            <span class="s1">&#39;*.js&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;!config*.js&#39;</span><span class="p">,</span> <span class="c1">// note: i added this, do we want this linted?</span>
                            <span class="s1">&#39;core/*.js&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;core/server/**/*.js&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;core/test/**/*.js&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;!core/test/coverage/**&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;!core/shared/vendor/**/*.js&#39;</span>
                        <span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grunt-mocha-cli">
  <h3>
    <a href="#grunt-mocha-cli" name="grunt-mocha-cli" class="pilcrow">&#182;</a>
    grunt-mocha-cli
  </h3>
</div>


<p>Configuration for the mocha test runner, used to run unit, integration and route tests as part of
<code>grunt validate</code>. See <a href="#validate">grunt validate</a> and its sub tasks for more information.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">mochacli</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">ui</span><span class="o">:</span> <span class="s1">&#39;bdd&#39;</span><span class="p">,</span>
                    <span class="nx">reporter</span><span class="o">:</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;reporter&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;spec&#39;</span><span class="p">,</span>
                    <span class="nx">timeout</span><span class="o">:</span> <span class="s1">&#39;15000&#39;</span><span class="p">,</span>
                    <span class="nx">save</span><span class="o">:</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;reporter-output&#39;</span><span class="p">)</span>
                <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="all%20unit%20tests">
  <h4>
    <a href="#all%20unit%20tests" name="all%20unit%20tests" class="pilcrow">&#182;</a>
    All Unit tests
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="nx">unit</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s1">&#39;core/test/unit/**/*_spec.js&#39;</span>
                    <span class="p">]</span>
                <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="groups%20of%20unit%20tests">
  <h5>
    <a href="#groups%20of%20unit%20tests" name="groups%20of%20unit%20tests" class="pilcrow">&#182;</a>
    Groups of unit tests
  </h5>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="nx">server</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/test/unit/**/server*_spec.js&#39;</span><span class="p">]</span>
                <span class="p">},</span>

                <span class="nx">helpers</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/test/unit/server_helpers/*_spec.js&#39;</span><span class="p">]</span>
                <span class="p">},</span>

                <span class="nx">middleware</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/test/unit/middleware/*_spec.js&#39;</span><span class="p">]</span>
                <span class="p">},</span>

                <span class="nx">showdown</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/test/unit/**/showdown*_spec.js&#39;</span><span class="p">]</span>
                <span class="p">},</span>

                <span class="nx">perm</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/test/unit/**/permissions_spec.js&#39;</span><span class="p">]</span>
                <span class="p">},</span>

                <span class="nx">migrate</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s1">&#39;core/test/unit/**/export_spec.js&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;core/test/unit/**/import_spec.js&#39;</span>
                    <span class="p">]</span>
                <span class="p">},</span>

                <span class="nx">storage</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/test/unit/**/storage*_spec.js&#39;</span><span class="p">]</span>
                <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="all%20integration%20tests">
  <h4>
    <a href="#all%20integration%20tests" name="all%20integration%20tests" class="pilcrow">&#182;</a>
    All Integration tests
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="nx">integration</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s1">&#39;core/test/integration/**/*_spec.js&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;core/test/integration/**/*_spec.js&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;core/test/integration/*_spec.js&#39;</span>
                    <span class="p">]</span>
                <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="model%20integration%20tests">
  <h5>
    <a href="#model%20integration%20tests" name="model%20integration%20tests" class="pilcrow">&#182;</a>
    Model integration tests
  </h5>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="nx">model</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/test/integration/**/model*_spec.js&#39;</span><span class="p">]</span>
                <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="api%20integration%20tests">
  <h5>
    <a href="#api%20integration%20tests" name="api%20integration%20tests" class="pilcrow">&#182;</a>
    API integration tests
  </h5>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="nx">api</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/test/integration/**/api*_spec.js&#39;</span><span class="p">]</span>
                <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="all%20route%20tests">
  <h4>
    <a href="#all%20route%20tests" name="all%20route%20tests" class="pilcrow">&#182;</a>
    All Route tests
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="nx">routes</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s1">&#39;core/test/functional/routes/**/*_spec.js&#39;</span>
                    <span class="p">]</span>
                <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="all%20module%20tests">
  <h4>
    <a href="#all%20module%20tests" name="all%20module%20tests" class="pilcrow">&#182;</a>
    All Module tests
  </h4>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s1">&#39;core/test/functional/module/**/*_spec.js&#39;</span>
                    <span class="p">]</span>
                <span class="p">}</span>
            <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grunt-mocha-istanbul">
  <h3>
    <a href="#grunt-mocha-istanbul" name="grunt-mocha-istanbul" class="pilcrow">&#182;</a>
    grunt-mocha-istanbul
  </h3>
</div>


<p>Configuration for the mocha test coverage generator
<code>grunt coverage</code>.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">mocha_istanbul</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">coverage</span><span class="o">:</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>TODO fix the timing/async &amp; cleanup issues with the route and integration tests so that
they can also have coverage generated for them &amp; the order doesn't matter</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/test/unit&#39;</span><span class="p">],</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">mask</span><span class="o">:</span> <span class="s1">&#39;**/*_spec.js&#39;</span><span class="p">,</span>
                        <span class="nx">coverageFolder</span><span class="o">:</span> <span class="s1">&#39;core/test/coverage/unit&#39;</span><span class="p">,</span>
                        <span class="nx">mochaOptions</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;--timeout=15000&#39;</span><span class="p">],</span>
                        <span class="nx">excludes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/client/**&#39;</span><span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">},</span>
                <span class="nx">coverage_integration</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/test/integration/api&#39;</span><span class="p">],</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">coverageFolder</span><span class="o">:</span> <span class="s1">&#39;core/test/coverage/integration&#39;</span><span class="p">,</span>
                        <span class="nx">mask</span><span class="o">:</span> <span class="s1">&#39;**/*_spec.js&#39;</span><span class="p">,</span>
                        <span class="nx">mochaOptions</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;--timeout=15000&#39;</span><span class="p">],</span>
                        <span class="nx">excludes</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/client/**&#39;</span><span class="p">,</span> <span class="s1">&#39;core/server/built&#39;</span><span class="p">,</span> <span class="s1">&#39;core/server/apps&#39;</span><span class="p">,</span> <span class="s1">&#39;core/server/config&#39;</span><span class="p">,</span> <span class="s1">&#39;core/server/data&#39;</span><span class="p">]</span>
                    <span class="p">}</span>

                <span class="p">}</span>
            <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grunt-bg-shell">
  <h3>
    <a href="#grunt-bg-shell" name="grunt-bg-shell" class="pilcrow">&#182;</a>
    grunt-bg-shell
  </h3>
</div>


<p>Used to run ember-cli watch in the background</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">bgShell</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">ember</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">cmd</span><span class="o">:</span> <span class="nx">emberPath</span> <span class="o">+</span> <span class="s1">&#39; build --watch&#39;</span><span class="p">,</span>
                    <span class="nx">execOpts</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">cwd</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">cwd</span> <span class="o">+</span> <span class="s1">&#39;/core/client/&#39;</span><span class="p">)</span>
                    <span class="p">},</span>
                    <span class="nx">bg</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                    <span class="nx">stdout</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">out</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">grunt</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nx">cyan</span><span class="p">(</span><span class="s1">&#39;Ember-cli::&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">out</span><span class="p">);</span>
                    <span class="p">},</span>
                    <span class="nx">stderror</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">grunt</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nx">red</span><span class="p">(</span><span class="s1">&#39;Ember-cli::&#39;</span> <span class="o">+</span> <span class="nx">error</span><span class="p">));</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grunt-shell">
  <h3>
    <a href="#grunt-shell" name="grunt-shell" class="pilcrow">&#182;</a>
    grunt-shell
  </h3>
</div>


<p>Command line tools where it's easier to run a command directly than configure a grunt plugin</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">shell</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">ember</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">command</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">switch</span> <span class="p">(</span><span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">case</span> <span class="s1">&#39;init&#39;</span><span class="o">:</span>
                                <span class="k">return</span> <span class="s1">&#39;echo Installing client dependencies... &amp;&amp; npm install&#39;</span><span class="p">;</span>

                            <span class="k">case</span> <span class="s1">&#39;prod&#39;</span><span class="o">:</span>
                                <span class="k">return</span> <span class="nx">emberPath</span> <span class="o">+</span> <span class="s1">&#39; build --environment=production --silent&#39;</span><span class="p">;</span>

                            <span class="k">case</span> <span class="s1">&#39;dev&#39;</span><span class="o">:</span>
                                <span class="k">return</span> <span class="nx">emberPath</span> <span class="o">+</span> <span class="s1">&#39; build&#39;</span><span class="p">;</span>

                            <span class="k">case</span> <span class="s1">&#39;test&#39;</span><span class="o">:</span>
                                <span class="k">return</span> <span class="nx">emberPath</span> <span class="o">+</span> <span class="s1">&#39; test --silent&#39;</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">},</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">execOptions</span><span class="o">:</span> <span class="p">{</span>
                            <span class="nx">cwd</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;/core/client/&#39;</span><span class="p">),</span>
                            <span class="nx">stdout</span><span class="o">:</span> <span class="kc">false</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">},</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="run%20bower%20install">
  <h4>
    <a href="#run%20bower%20install" name="run%20bower%20install" class="pilcrow">&#182;</a>
    Run bower install
  </h4>
</div>


<p>Used as part of <code>grunt init</code>. See the section on <a href="#building%20assets">Building Assets</a> for more
information.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="nx">bower</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">command</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">cwd</span> <span class="o">+</span> <span class="s1">&#39;/node_modules/.bin/bower --allow-root install&#39;</span><span class="p">),</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">stdout</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                        <span class="nx">stdin</span><span class="o">:</span> <span class="kc">false</span>
                    <span class="p">}</span>
                <span class="p">},</span>

                <span class="nx">test</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">command</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">test</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="s1">&#39;node &#39;</span> <span class="o">+</span> <span class="nx">mochaPath</span>  <span class="o">+</span> <span class="s1">&#39; --timeout=15000 --ui=bdd --reporter=spec --colors core/test/&#39;</span> <span class="o">+</span> <span class="nx">test</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">},</span>

                <span class="nx">shrinkwrap</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">command</span><span class="o">:</span> <span class="s1">&#39;npm shrinkwrap&#39;</span>
                <span class="p">},</span>

                <span class="nx">dedupe</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">command</span><span class="o">:</span> <span class="s1">&#39;npm dedupe&#39;</span>
                <span class="p">},</span>

                <span class="nx">csscombfix</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">command</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">cwd</span> <span class="o">+</span> <span class="s1">&#39;/node_modules/.bin/csscomb -c core/client/app/styles/csscomb.json -v core/client/app/styles&#39;</span><span class="p">)</span>
                <span class="p">},</span>

                <span class="nx">csscomblint</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">command</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">cwd</span> <span class="o">+</span> <span class="s1">&#39;/node_modules/.bin/csscomb -c core/client/app/styles/csscomb.json -lv core/client/app/styles&#39;</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grunt-docker">
  <h3>
    <a href="#grunt-docker" name="grunt-docker" class="pilcrow">&#182;</a>
    grunt-docker
  </h3>
</div>


<p>Generate documentation from code</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">docker</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">docs</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">dest</span><span class="o">:</span> <span class="s1">&#39;docs&#39;</span><span class="p">,</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">],</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">onlyUpdated</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                        <span class="nx">exclude</span><span class="o">:</span> <span class="s1">&#39;node_modules,bower_components,content,core/client,*test,*doc*,&#39;</span> <span class="o">+</span>
                        <span class="s1">&#39;*vendor,config.js,*buil*,.dist*,.idea,.git*,.travis.yml,.bower*,.editorconfig,.js*,*.md&#39;</span><span class="p">,</span>
                        <span class="nx">extras</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;fileSearch&#39;</span><span class="p">]</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grunt-contrib-clean">
  <h3>
    <a href="#grunt-contrib-clean" name="grunt-contrib-clean" class="pilcrow">&#182;</a>
    grunt-contrib-clean
  </h3>
</div>


<p>Clean up files as part of other tasks</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">clean</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">built</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span>
                        <span class="s1">&#39;core/built/**&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;core/client/dist/**&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;core/client/public/assets/img/contributors/**&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;core/client/app/templates/-contributors.hbs&#39;</span>
                    <span class="p">]</span>
                <span class="p">},</span>
                <span class="nx">release</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;&lt;%= paths.releaseBuild %&gt;/**&#39;</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="nx">test</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;content/data/ghost-test.db&#39;</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="nx">tmp</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;.tmp/**&#39;</span><span class="p">]</span>
                <span class="p">},</span>
                <span class="nx">dependencies</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;node_modules/**&#39;</span><span class="p">,</span> <span class="s1">&#39;core/client/bower_components/**&#39;</span><span class="p">,</span> <span class="s1">&#39;core/client/node_modules/**&#39;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grunt-contrib-compress">
  <h3>
    <a href="#grunt-contrib-compress" name="grunt-contrib-compress" class="pilcrow">&#182;</a>
    grunt-contrib-compress
  </h3>
</div>


<p>Zip up files for builds / releases</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">compress</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">release</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">archive</span><span class="o">:</span> <span class="s1">&#39;&lt;%= paths.releaseDist %&gt;/Ghost-&lt;%= pkg.version %&gt;.zip&#39;</span>
                    <span class="p">},</span>
                    <span class="nx">expand</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
                    <span class="nx">cwd</span><span class="o">:</span> <span class="s1">&#39;&lt;%= paths.releaseBuild %&gt;/&#39;</span><span class="p">,</span>
                    <span class="nx">src</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;**&#39;</span><span class="p">]</span>
                <span class="p">}</span>
            <span class="p">},</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="grunt-update-submodules">
  <h3>
    <a href="#grunt-update-submodules" name="grunt-update-submodules" class="pilcrow">&#182;</a>
    grunt-update-submodules
  </h3>
</div>


<p>Grunt task to update git submodules</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">update_submodules</span><span class="o">:</span> <span class="p">{</span>
                <span class="k">default</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">params</span><span class="o">:</span> <span class="s1">&#39;--init&#39;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">},</span>

            <span class="nx">uglify</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">prod</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">sourceMap</span><span class="o">:</span> <span class="kc">false</span>
                    <span class="p">},</span>
                    <span class="nx">files</span><span class="o">:</span> <span class="p">{</span>
                        <span class="s1">&#39;core/shared/ghost-url.min.js&#39;</span><span class="o">:</span> <span class="s1">&#39;core/shared/ghost-url.js&#39;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Load the configuration</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">initConfig</span><span class="p">(</span><span class="nx">cfg</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="utilities">
  <h2>
    <a href="#utilities" name="utilities" class="pilcrow">&#182;</a>
    Utilities
  </h2>
</div>



<div class="pilwrap" id="spawn%20casper.js">
  <h3>
    <a href="#spawn%20casper.js" name="spawn%20casper.js" class="pilcrow">&#182;</a>
    Spawn Casper.js
  </h3>
</div>


<p>Custom test runner for our Casper.js functional tests
This really ought to be refactored into a separate grunt task module</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;spawnCasperJS&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">target</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">contains</span><span class="p">([</span><span class="s1">&#39;client&#39;</span><span class="p">,</span> <span class="s1">&#39;setup&#39;</span><span class="p">],</span> <span class="nx">target</span><span class="p">)</span> <span class="o">?</span> <span class="nx">target</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">;</span>

            <span class="kd">var</span> <span class="nx">done</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">async</span><span class="p">(),</span>
                <span class="nx">options</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">,</span> <span class="s1">&#39;noPort&#39;</span><span class="p">,</span> <span class="s1">&#39;port&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;password&#39;</span><span class="p">],</span>
                <span class="nx">args</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;test&#39;</span><span class="p">]</span>
                    <span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">target</span> <span class="o">||</span> <span class="p">[</span><span class="s1">&#39;client/&#39;</span><span class="p">])</span>
                    <span class="p">.</span><span class="nx">concat</span><span class="p">([</span><span class="s1">&#39;--includes=base.js&#39;</span><span class="p">,</span> <span class="s1">&#39;--log-level=debug&#39;</span><span class="p">,</span> <span class="s1">&#39;--port=2369&#39;</span><span class="p">]);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<p>Forward parameters from grunt to casperjs</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">_</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="kd">function</span> <span class="nx">processOption</span><span class="p">(</span><span class="nx">option</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="nx">option</span><span class="p">))</span> <span class="p">{</span>
                    <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;--&#39;</span> <span class="o">+</span> <span class="nx">option</span> <span class="o">+</span> <span class="s1">&#39;=&#39;</span> <span class="o">+</span> <span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="nx">option</span><span class="p">));</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;fail-fast&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;--fail-fast&#39;</span><span class="p">);</span>
            <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>Show concise logs in Travis as ours are getting too long</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">if</span> <span class="p">(</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;concise&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TRAVIS</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;--concise&#39;</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">args</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;--verbose&#39;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">grunt</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">spawn</span><span class="p">({</span>
                <span class="nx">cmd</span><span class="o">:</span> <span class="s1">&#39;casperjs&#39;</span><span class="p">,</span>
                <span class="nx">args</span><span class="o">:</span> <span class="nx">args</span><span class="p">,</span>
                <span class="nx">opts</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">cwd</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s1">&#39;core/test/functional&#39;</span><span class="p">),</span>
                    <span class="nx">stdio</span><span class="o">:</span> <span class="s1">&#39;inherit&#39;</span>
                <span class="p">}</span>
            <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">,</span> <span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
                <span class="cm">/*jshint unused:false*/</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">grunt</span><span class="p">.</span><span class="nx">fail</span><span class="p">.</span><span class="nx">fatal</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">stderr</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">grunt</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">stdout</span><span class="p">);</span>
                <span class="nx">done</span><span class="p">();</span>
            <span class="p">});</span>
        <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="custom%20tasks">
  <h1>
    <a href="#custom%20tasks" name="custom%20tasks" class="pilcrow">&#182;</a>
    Custom Tasks
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>Ghost has a number of useful tasks that we use every day in development. Tasks marked as <em>Utility</em> are used
by grunt to perform current actions, but isn't useful to developers.</p>

<p>Skip ahead to the section on:</p>

<ul>
<li><a href="#building%20assets">Building assets</a>:
<code>grunt init</code>, <code>grunt</code> &amp; <code>grunt prod</code> or live reload with <code>grunt dev</code></li>
<li><a href="#testing">Testing</a>:
<code>grunt validate</code>, the <code>grunt test-*</code> sub-tasks or generate a coverage report with <code>grunt coverage</code>.</li>
</ul>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="help">
  <h3>
    <a href="#help" name="help" class="pilcrow">&#182;</a>
    Help
  </h3>
</div>


<p>Run <code>grunt help</code> on the commandline to get a print out of the available tasks and details of
what each one does along with any available options. This is an alias for <code>grunt --help</code></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;help&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Outputs help information if you type `grunt help` instead of `grunt --help`&#39;</span><span class="p">,</span>
            <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Type `grunt --help` to get the details of available grunt tasks, &#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;or alternatively visit https://github.com/TryGhost/Ghost/wiki/Grunt-Toolkit&#39;</span><span class="p">);</span>
            <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="documentation">
  <h3>
    <a href="#documentation" name="documentation" class="pilcrow">&#182;</a>
    Documentation
  </h3>
</div>


<p>Run <code>grunt docs</code> to generate annotated source code using the documentation described in the code comments.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;docs&#39;</span><span class="p">,</span> <span class="s1">&#39;Generate Docs&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;docker&#39;</span><span class="p">]);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<p>Runun <code>grunt watch-docs</code> to setup livereload &amp; watch whilst you're editing the docs</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;watch-docs&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">merge</span><span class="p">({</span>
                <span class="nx">watch</span><span class="o">:</span> <span class="p">{</span>
                    <span class="nx">docs</span><span class="o">:</span> <span class="p">{</span>
                        <span class="nx">files</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;core/server/**/*&#39;</span><span class="p">,</span> <span class="s1">&#39;index.js&#39;</span><span class="p">,</span> <span class="s1">&#39;Gruntfile.js&#39;</span><span class="p">,</span> <span class="s1">&#39;config.example.js&#39;</span><span class="p">],</span>
                        <span class="nx">tasks</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;docker&#39;</span><span class="p">],</span>
                        <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
                            <span class="nx">livereload</span><span class="o">:</span> <span class="kc">true</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>

            <span class="nx">grunt</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;watch:docs&#39;</span><span class="p">);</span>
        <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="testing">
  <h2>
    <a href="#testing" name="testing" class="pilcrow">&#182;</a>
    Testing
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<p>Ghost has an extensive set of test suites. The following section documents the various types of tests
and how to run them.</p>

<p>TLDR; run <code>grunt validate</code></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="set%20test%20env%20(utility%20task)">
  <h4>
    <a href="#set%20test%20env%20(utility%20task)" name="set%20test%20env%20(utility%20task)" class="pilcrow">&#182;</a>
    Set Test Env <em>(Utility Task)</em>
  </h4>
</div>


<p>Set the NODE_ENV to 'testing' unless the environment is already set to TRAVIS.
This ensures that the tests get run under the correct environment, using the correct database, and
that they work as expected. Trying to run tests with no ENV set will throw an error to do with <code>client</code>.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;setTestEnv&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Use &quot;testing&quot; Ghost config; unless we are running on travis (then show queries for debugging)&#39;</span><span class="p">,</span>
            <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TRAVIS</span> <span class="o">?</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span> <span class="o">:</span> <span class="s1">&#39;testing&#39;</span><span class="p">;</span>
                <span class="nx">cfg</span><span class="p">.</span><span class="nx">express</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">node_env</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="p">;</span>
            <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="ensure%20config%20(utility%20task)">
  <h4>
    <a href="#ensure%20config%20(utility%20task)" name="ensure%20config%20(utility%20task)" class="pilcrow">&#182;</a>
    Ensure Config <em>(Utility Task)</em>
  </h4>
</div>


<p>Make sure that we have a <code>config.js</code> file when running tests
Ghost requires a <code>config.js</code> file to specify the database settings etc. Ghost comes with an example file:
<code>config.example.js</code> which is copied and renamed to <code>config.js</code> by the bootstrap process</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;ensureConfig&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">config</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core/server/config&#39;</span><span class="p">),</span>
                <span class="nx">done</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">async</span><span class="p">();</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TEST_SUITE</span> <span class="o">||</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TEST_SUITE</span> <span class="o">!==</span> <span class="s1">&#39;client&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">config</span><span class="p">.</span><span class="nx">load</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                    <span class="nx">done</span><span class="p">();</span>
                <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">grunt</span><span class="p">.</span><span class="nx">fail</span><span class="p">.</span><span class="nx">fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
                <span class="p">});</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">done</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="reset%20database%20to%20%22new%22%20state%20(utility%20task)">
  <h4>
    <a href="#reset%20database%20to%20%22new%22%20state%20(utility%20task)" name="reset%20database%20to%20%22new%22%20state%20(utility%20task)" class="pilcrow">&#182;</a>
    Reset Database to "New" state <em>(Utility Task)</em>
  </h4>
</div>


<p>Drops all database tables and then runs the migration process to put the database
in a "new" state.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;cleanDatabase&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">done</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">async</span><span class="p">(),</span>
                <span class="nx">models</span>    <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core/server/models&#39;</span><span class="p">),</span>
                <span class="nx">migration</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./core/server/data/migration&#39;</span><span class="p">);</span>

            <span class="nx">migration</span><span class="p">.</span><span class="nx">reset</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">models</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
            <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nx">migration</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
            <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">done</span><span class="p">();</span>
            <span class="p">}).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">grunt</span><span class="p">.</span><span class="nx">fail</span><span class="p">.</span><span class="nx">fatal</span><span class="p">(</span><span class="nx">err</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">});</span>

        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">test</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">test</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">grunt</span><span class="p">.</span><span class="nx">fail</span><span class="p">.</span><span class="nx">fatal</span><span class="p">(</span><span class="s1">&#39;No test provided. `grunt test` expects a filename. e.g.: `grunt test:unit/apps_spec.js`. Did you mean `npm test` or `grunt validate`?&#39;</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">grunt</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;test-setup&#39;</span><span class="p">,</span> <span class="s1">&#39;shell:test:&#39;</span> <span class="o">+</span> <span class="nx">test</span><span class="p">);</span>
        <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="validate">
  <h3>
    <a href="#validate" name="validate" class="pilcrow">&#182;</a>
    Validate
  </h3>
</div>


<p><strong>Main testing task</strong></p>

<p><code>grunt validate</code> will build, lint and test your local Ghost codebase.</p>

<p><code>grunt validate</code> is one of the most important and useful grunt tasks that we have available to use. It
manages the build of your environment and then calls <code>grunt test</code></p>

<p><code>grunt validate</code> is called by <code>npm test</code> and is used by Travis.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;validate&#39;</span><span class="p">,</span> <span class="s1">&#39;Run tests and lint code&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TEST_SUITE</span> <span class="o">===</span> <span class="s1">&#39;server&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">grunt</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">run</span><span class="p">([</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="s1">&#39;test-server&#39;</span><span class="p">]);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TEST_SUITE</span> <span class="o">===</span> <span class="s1">&#39;client&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">grunt</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">run</span><span class="p">([</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="s1">&#39;test-client&#39;</span><span class="p">]);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TEST_SUITE</span> <span class="o">===</span> <span class="s1">&#39;lint&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">grunt</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">run</span><span class="p">([</span><span class="s1">&#39;shell:ember:init&#39;</span><span class="p">,</span> <span class="s1">&#39;shell:bower&#39;</span><span class="p">,</span> <span class="s1">&#39;lint&#39;</span><span class="p">]);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">grunt</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">run</span><span class="p">([</span><span class="s1">&#39;validate-all&#39;</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;validate-all&#39;</span><span class="p">,</span> <span class="s1">&#39;Lint code and run all tests&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="s1">&#39;lint&#39;</span><span class="p">,</span> <span class="s1">&#39;test-all&#39;</span><span class="p">]);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="test-all">
  <h3>
    <a href="#test-all" name="test-all" class="pilcrow">&#182;</a>
    Test-All
  </h3>
</div>


<p><strong>Main testing task</strong></p>

<p><code>grunt test-all</code> will lint and test your pre-built local Ghost codebase.</p>

<p><code>grunt test-all</code> runs all 6 test suites. See the individual sub tasks below for
details of each of the test suites.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test-all&#39;</span><span class="p">,</span> <span class="s1">&#39;Run tests for both server and client&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;test-server&#39;</span><span class="p">,</span> <span class="s1">&#39;test-client&#39;</span><span class="p">]);</span>

        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test-server&#39;</span><span class="p">,</span> <span class="s1">&#39;Run server tests&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;test-routes&#39;</span><span class="p">,</span> <span class="s1">&#39;test-module&#39;</span><span class="p">,</span> <span class="s1">&#39;test-unit&#39;</span><span class="p">,</span> <span class="s1">&#39;test-integration&#39;</span><span class="p">]);</span>

        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test-client&#39;</span><span class="p">,</span> <span class="s1">&#39;Run client tests&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;test-ember&#39;</span><span class="p">]);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="lint">
  <h3>
    <a href="#lint" name="lint" class="pilcrow">&#182;</a>
    Lint
  </h3>
</div>


<p><code>grunt lint</code> will run the linter and the code style checker so you can make sure your code is pretty</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;lint&#39;</span><span class="p">,</span> <span class="s1">&#39;Run the code style checks and linter&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;jshint&#39;</span><span class="p">,</span> <span class="s1">&#39;jscs&#39;</span><span class="p">,</span> <span class="s1">&#39;shell:csscomblint&#39;</span><span class="p">]</span>
        <span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="test-setup%20*(utility)(">
  <h3>
    <a href="#test-setup%20*(utility)(" name="test-setup%20*(utility)(" class="pilcrow">&#182;</a>
    test-setup *(utility)(
  </h3>
</div>


<p><code>grunt test-setup</code> will run all the setup tasks required for running tests</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test-setup&#39;</span><span class="p">,</span> <span class="s1">&#39;Setup ready to run tests&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;clean:test&#39;</span><span class="p">,</span> <span class="s1">&#39;setTestEnv&#39;</span><span class="p">,</span> <span class="s1">&#39;ensureConfig&#39;</span><span class="p">]</span>
        <span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="unit%20tests%20(sub%20task)">
  <h3>
    <a href="#unit%20tests%20(sub%20task)" name="unit%20tests%20(sub%20task)" class="pilcrow">&#182;</a>
    Unit Tests <em>(sub task)</em>
  </h3>
</div>


<p><code>grunt test-unit</code> will run just the unit tests</p>

<p>Provided you already have a <code>config.js</code> file, you can run individual sections from
<a href="#grunt-mocha-cli">mochacli</a> by running:</p>

<p><code>NODE_ENV=testing grunt mochacli:section</code></p>

<p>If you need to run an individual unit test file, you can do so, providing you have mocha installed globally
by using a command in the form:</p>

<p><code>NODE_ENV=testing mocha --timeout=15000 --ui=bdd --reporter=spec core/test/unit/config_spec.js</code></p>

<p>Unit tests are run with <a href="http://mochajs.org/">mocha</a> using
<a href="https://github.com/visionmedia/should.js">should</a> to describe the tests in a highly readable style.
Unit tests do <strong>not</strong> touch the database.
A coverage report can be generated for these tests using the <code>grunt test-coverage</code> task.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test-unit&#39;</span><span class="p">,</span> <span class="s1">&#39;Run unit tests (mocha)&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;test-setup&#39;</span><span class="p">,</span> <span class="s1">&#39;mochacli:unit&#39;</span><span class="p">]</span>
        <span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="integration%20tests%20(sub%20task)">
  <h3>
    <a href="#integration%20tests%20(sub%20task)" name="integration%20tests%20(sub%20task)" class="pilcrow">&#182;</a>
    Integration tests <em>(sub task)</em>
  </h3>
</div>


<p><code>grunt test-integration</code> will run just the integration tests</p>

<p>Provided you already have a <code>config.js</code> file, you can run just the model integration tests by running:</p>

<p><code>NODE_ENV=testing grunt mochacli:model</code></p>

<p>Or just the api integration tests by running:</p>

<p><code>NODE_ENV=testing grunt mochacli:api</code></p>

<p>Integration tests are run with <a href="http://mochajs.org/">mocha</a> using
<a href="https://github.com/visionmedia/should.js">should</a> to describe the tests in a highly readable style.
Integration tests are different to the unit tests because they make requests to the database.</p>

<p>If you need to run an individual integration test file you can do so, providing you have mocha installed
globally, by using a command in the form (replace path to api_tags_spec.js with the test file you want to
run):</p>

<p><code>NODE_ENV=testing mocha --timeout=15000 --ui=bdd --reporter=spec core/test/integration/api/api_tags_spec.js</code></p>

<p>Their purpose is to test that both the api and models behave as expected when the database layer is involved.
These tests are run against sqlite3, mysql and pg on travis and ensure that differences between the databases
don't cause bugs. At present, pg often fails and is not officially supported.</p>

<p>A coverage report can be generated for these tests using the <code>grunt test-coverage</code> task.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test-integration&#39;</span><span class="p">,</span> <span class="s1">&#39;Run integration tests (mocha + db access)&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;test-setup&#39;</span><span class="p">,</span> <span class="s1">&#39;mochacli:integration&#39;</span><span class="p">]</span>
        <span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="route%20tests%20(sub%20task)">
  <h3>
    <a href="#route%20tests%20(sub%20task)" name="route%20tests%20(sub%20task)" class="pilcrow">&#182;</a>
    Route tests <em>(sub task)</em>
  </h3>
</div>


<p><code>grunt test-routes</code> will run just the route tests</p>

<p>If you need to run an individual route test file, you can do so, providing you have a <code>config.js</code> file and
mocha installed globally by using a command in the form:</p>

<p><code>NODE_ENV=testing mocha --timeout=15000 --ui=bdd --reporter=spec core/test/functional/routes/admin_spec.js</code></p>

<p>Route tests are run with <a href="http://mochajs.org/">mocha</a> using
<a href="https://github.com/visionmedia/should.js">should</a> and <a href="https://github.com/visionmedia/supertest">supertest</a>
to describe and create the tests.</p>

<p>Supertest enables us to describe requests that we want to make, and also describe the response we expect to
receive back. It works directly with express, so we don't have to run a server to run the tests.</p>

<p>The purpose of the route tests is to ensure that all of the routes (pages, and API requests) in Ghost
are working as expected, including checking the headers and status codes received. It is very easy and
quick to test many permutations of routes / urls in the system.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test-routes&#39;</span><span class="p">,</span> <span class="s1">&#39;Run functional route tests (mocha)&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;test-setup&#39;</span><span class="p">,</span> <span class="s1">&#39;mochacli:routes&#39;</span><span class="p">]</span>
        <span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="module%20tests%20(sub%20task)">
  <h3>
    <a href="#module%20tests%20(sub%20task)" name="module%20tests%20(sub%20task)" class="pilcrow">&#182;</a>
    Module tests <em>(sub task)</em>
  </h3>
</div>


<p><code>grunt test-module</code> will run just the module tests</p>

<p>The purpose of the module tests is to ensure that Ghost can be used as an npm module and exposes all
required methods to interact with it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test-module&#39;</span><span class="p">,</span> <span class="s1">&#39;Run functional module tests (mocha)&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;test-setup&#39;</span><span class="p">,</span> <span class="s1">&#39;mochacli:module&#39;</span><span class="p">]</span>
        <span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="ember%20unit%20tests%20(sub%20task)">
  <h3>
    <a href="#ember%20unit%20tests%20(sub%20task)" name="ember%20unit%20tests%20(sub%20task)" class="pilcrow">&#182;</a>
    Ember unit tests <em>(sub task)</em>
  </h3>
</div>


<p><code>grunt test-ember</code> will run just the ember unit tests</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test-ember&#39;</span><span class="p">,</span> <span class="s1">&#39;Run the ember unit tests&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;test-setup&#39;</span><span class="p">,</span> <span class="s1">&#39;shell:ember:test&#39;</span><span class="p">]</span>
        <span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="functional%20tests%20(sub%20task)">
  <h3>
    <a href="#functional%20tests%20(sub%20task)" name="functional%20tests%20(sub%20task)" class="pilcrow">&#182;</a>
    Functional tests <em>(sub task)</em>
  </h3>
</div>


<p><code>grunt test-functional</code> will run just the functional tests</p>

<p>You can use the <code>--target</code> argument to run any individual test file, or the admin or frontend tests:</p>

<p><code>grunt test-functional --target=client/editor_test.js</code> - run just the editor tests</p>

<p><code>grunt test-functional --target=client/</code> - run all of the tests in the client directory</p>

<p>Functional tests are run with <a href="http://phantomjs.org/">phantom.js</a> and defined using the testing api from
<a href="http://docs.casperjs.org/en/latest/testing.html">casper.js</a>.</p>

<p>An express server is started with the testing environment set, and then a headless phantom.js browser is
used to make requests to that server. The Casper.js API then allows us to describe the elements and
interactions we expect to appear on the page.</p>

<p>The purpose of the functional tests is to ensure that Ghost is working as is expected from a user perspective
including buttons and other important interactions in the admin UI.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test-functional&#39;</span><span class="p">,</span> <span class="s1">&#39;Run functional interface tests (CasperJS)&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;test-setup&#39;</span><span class="p">,</span> <span class="s1">&#39;shell:ember:dev&#39;</span><span class="p">,</span> <span class="s1">&#39;cleanDatabase&#39;</span><span class="p">,</span> <span class="s1">&#39;express:test&#39;</span><span class="p">,</span> <span class="s1">&#39;spawnCasperJS&#39;</span><span class="p">,</span> <span class="s1">&#39;express:test:stop&#39;</span><span class="p">,</span> <span class="s1">&#39;test-functional-setup&#39;</span><span class="p">]</span>
        <span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="functional%20tests%20for%20the%20setup%20process">
  <h3>
    <a href="#functional%20tests%20for%20the%20setup%20process" name="functional%20tests%20for%20the%20setup%20process" class="pilcrow">&#182;</a>
    Functional tests for the setup process
  </h3>
</div>


<p>`grunt test-functional-setup will run just the functional tests for the setup page.</p>

<p>Setup only works with a brand new database, so it needs to run isolated from the rest of
the functional tests.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;test-functional-setup&#39;</span><span class="p">,</span> <span class="s1">&#39;Run functional tests for setup&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;test-setup&#39;</span><span class="p">,</span> <span class="s1">&#39;cleanDatabase&#39;</span><span class="p">,</span> <span class="s1">&#39;express:test&#39;</span><span class="p">,</span> <span class="s1">&#39;spawnCasperJS:setup&#39;</span><span class="p">,</span> <span class="s1">&#39;express:test:stop&#39;</span><span class="p">]</span>
        <span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="coverage">
  <h3>
    <a href="#coverage" name="coverage" class="pilcrow">&#182;</a>
    Coverage
  </h3>
</div>


<p><code>grunt coverage</code> will generate a report for the Unit Tests.</p>

<p>This is not currently done as part of CI or any build, but is a tool we have available to keep an eye on how
well the unit and integration tests are covering the code base.
Ghost does not have a minimum coverage level - we're more interested in ensuring important and useful areas
of the codebase are covered, than that the whole codebase is covered to a particular level.</p>

<p>Key areas for coverage are: helpers and theme elements, apps / GDK, the api and model layers.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;coverage&#39;</span><span class="p">,</span> <span class="s1">&#39;Generate unit and integration (mocha) tests coverage report&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;test-setup&#39;</span><span class="p">,</span> <span class="s1">&#39;mocha_istanbul:coverage&#39;</span><span class="p">]</span>
        <span class="p">);</span>

        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;coverage-integration&#39;</span><span class="p">,</span> <span class="s1">&#39;Generate unit and integration tests coverage report&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;test-setup&#39;</span><span class="p">,</span> <span class="s1">&#39;mocha_istanbul:coverage_integration&#39;</span><span class="p">]</span>
        <span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="master%20warning%20(utility%20task)">
  <h4>
    <a href="#master%20warning%20(utility%20task)" name="master%20warning%20(utility%20task)" class="pilcrow">&#182;</a>
    Master Warning <em>(Utility Task)</em>
  </h4>
</div>


<p>Warns git users not ot use the <code>master</code> branch in production.
<code>master</code> is an unstable branch and shouldn't be used in production as you run the risk of ending up with a
database in an unrecoverable state. Instead there is a branch called <code>stable</code> which is the equivalent of the
release zip for git users.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;master-warn&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Outputs a warning to runners of grunt prod, that master shouldn\&#39;t be used for live blogs&#39;</span><span class="p">,</span>
            <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span> <span class="nx">chalk</span><span class="p">.</span><span class="nx">red</span><span class="p">(</span><span class="s1">&#39;Always two there are, no more, no less. A master and a&#39;</span><span class="p">),</span>
                        <span class="nx">chalk</span><span class="p">.</span><span class="nx">bold</span><span class="p">.</span><span class="nx">red</span><span class="p">(</span><span class="s1">&#39;stable&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">chalk</span><span class="p">.</span><span class="nx">red</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">));</span>
                <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Use the&#39;</span><span class="p">,</span> <span class="nx">chalk</span><span class="p">.</span><span class="nx">bold</span><span class="p">(</span><span class="s1">&#39;stable&#39;</span><span class="p">),</span> <span class="s1">&#39;branch for live blogs.&#39;</span><span class="p">,</span> <span class="nx">chalk</span><span class="p">.</span><span class="nx">bold</span><span class="p">(</span><span class="s1">&#39;Never&#39;</span><span class="p">),</span> <span class="s1">&#39;master!&#39;</span><span class="p">);</span>
            <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="build%20about%20page%20(utility%20task)">
  <h3>
    <a href="#build%20about%20page%20(utility%20task)" name="build%20about%20page%20(utility%20task)" class="pilcrow">&#182;</a>
    Build About Page <em>(Utility Task)</em>
  </h3>
</div>


<p>Builds the github contributors partial template used on the Settings/About page,
and downloads the avatar for each of the users.
Run by any task that compiles the ember assets or manually via <code>grunt buildAboutPage</code>.
Only builds if the contributors template does not exist.
To force a build regardless, supply the --force option.
    <code>grunt buildAboutPage --force</code></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;buildAboutPage&#39;</span><span class="p">,</span> <span class="s1">&#39;Compile assets for the About Ghost page&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">done</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">async</span><span class="p">(),</span>
                <span class="nx">templatePath</span> <span class="o">=</span> <span class="s1">&#39;core/client/app/templates/-contributors.hbs&#39;</span><span class="p">,</span>
                <span class="nx">imagePath</span> <span class="o">=</span> <span class="s1">&#39;core/client/public/assets/img/contributors/&#39;</span><span class="p">,</span>
                <span class="nx">timeSpan</span> <span class="o">=</span> <span class="nx">moment</span><span class="p">().</span><span class="nx">subtract</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="s1">&#39;days&#39;</span><span class="p">).</span><span class="nx">format</span><span class="p">(</span><span class="s1">&#39;YYYY-MM-DD&#39;</span><span class="p">),</span>
                <span class="nx">oauthKey</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">GITHUB_OAUTH_KEY</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">existsSync</span><span class="p">(</span><span class="nx">templatePath</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">grunt</span><span class="p">.</span><span class="nx">option</span><span class="p">(</span><span class="s1">&#39;force&#39;</span><span class="p">))</span> <span class="p">{</span>
                <span class="nx">grunt</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="s1">&#39;Contributors template already exists.&#39;</span><span class="p">);</span>
                <span class="nx">grunt</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="nx">chalk</span><span class="p">.</span><span class="nx">bold</span><span class="p">(</span><span class="s1">&#39;Skipped&#39;</span><span class="p">));</span>
                <span class="k">return</span> <span class="nx">done</span><span class="p">();</span>
            <span class="p">}</span>

            <span class="nx">grunt</span><span class="p">.</span><span class="nx">verbose</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="s1">&#39;Downloading release and contributor information from GitHub&#39;</span><span class="p">);</span>

            <span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span>
                <span class="nx">Promise</span><span class="p">.</span><span class="nx">promisify</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">mkdirs</span><span class="p">)(</span><span class="nx">imagePath</span><span class="p">),</span>
                <span class="nx">getTopContribs</span><span class="p">({</span>
                    <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;tryghost&#39;</span><span class="p">,</span>
                    <span class="nx">repo</span><span class="o">:</span> <span class="s1">&#39;ghost&#39;</span><span class="p">,</span>
                    <span class="nx">oauthKey</span><span class="o">:</span> <span class="nx">oauthKey</span><span class="p">,</span>
                    <span class="nx">sinceDate</span><span class="o">:</span> <span class="nx">timeSpan</span><span class="p">,</span>
                    <span class="nx">count</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span>
                    <span class="nx">retry</span><span class="o">:</span> <span class="kc">true</span>
                <span class="p">})</span>
            <span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">results</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">contributors</span> <span class="o">=</span> <span class="nx">results</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="nx">contributorTemplate</span> <span class="o">=</span> <span class="s1">&#39;&lt;article&gt;\n    &lt;a href=&quot;&lt;%githubUrl%&gt;&quot; title=&quot;&lt;%name%&gt;&quot;&gt;\n&#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;        &lt;img src=&quot;{{gh-path &quot;admin&quot; &quot;/img/contributors&quot;}}/&lt;%name%&gt;&quot; alt=&quot;&lt;%name%&gt;&quot; /&gt;\n&#39;</span> <span class="o">+</span>
                    <span class="s1">&#39;    &lt;/a&gt;\n&lt;/article&gt;&#39;</span><span class="p">,</span>

                    <span class="nx">downloadImagePromise</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="k">new</span> <span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">request</span><span class="p">(</span><span class="nx">url</span><span class="p">)</span>
                            <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="nx">imagePath</span> <span class="o">+</span> <span class="nx">name</span><span class="p">))</span>
                            <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;close&#39;</span><span class="p">,</span> <span class="nx">resolve</span><span class="p">)</span>
                            <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nx">reject</span><span class="p">);</span>
                        <span class="p">});</span>
                    <span class="p">};</span>

                <span class="nx">grunt</span><span class="p">.</span><span class="nx">verbose</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="s1">&#39;Creating contributors template.&#39;</span><span class="p">);</span>
                <span class="nx">grunt</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">templatePath</span><span class="p">,</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55">&#182;</a>
</div>
<p>Map contributors to the template.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                    <span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">contributors</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">contributor</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">contributorTemplate</span>
                            <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;%githubUrl%&gt;/g</span><span class="p">,</span> <span class="nx">contributor</span><span class="p">.</span><span class="nx">githubUrl</span><span class="p">)</span>
                            <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;%name%&gt;/g</span><span class="p">,</span> <span class="nx">contributor</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
                    <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">)</span>
                <span class="p">);</span>

                <span class="nx">grunt</span><span class="p">.</span><span class="nx">verbose</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="s1">&#39;Downloading images for top contributors&#39;</span><span class="p">);</span>
                <span class="k">return</span> <span class="nx">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">_</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">contributors</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">contributor</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="nx">downloadImagePromise</span><span class="p">(</span><span class="nx">contributor</span><span class="p">.</span><span class="nx">avatarUrl</span> <span class="o">+</span> <span class="s1">&#39;&amp;s=60&#39;</span><span class="p">,</span> <span class="nx">contributor</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
                <span class="p">}));</span>
            <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="nx">done</span><span class="p">).</span><span class="k">catch</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">grunt</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">error</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">http_status</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">grunt</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="s1">&#39;GitHub API request returned status: &#39;</span> <span class="o">+</span> <span class="nx">error</span><span class="p">.</span><span class="nx">http_status</span><span class="p">);</span>
                <span class="p">}</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">ratelimit_limit</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">grunt</span><span class="p">.</span><span class="nx">log</span><span class="p">.</span><span class="nx">writeln</span><span class="p">(</span><span class="s1">&#39;Rate limit data: limit: %d, remaining: %d, reset: %s&#39;</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">ratelimit_limit</span><span class="p">,</span> <span class="nx">error</span><span class="p">.</span><span class="nx">ratelimit_remaining</span><span class="p">,</span> <span class="nx">moment</span><span class="p">.</span><span class="nx">unix</span><span class="p">(</span><span class="nx">error</span><span class="p">.</span><span class="nx">ratelimit_reset</span><span class="p">).</span><span class="nx">fromNow</span><span class="p">());</span>
                <span class="p">}</span>

                <span class="nx">done</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">});</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="building%20assets">
  <h2>
    <a href="#building%20assets" name="building%20assets" class="pilcrow">&#182;</a>
    Building assets
  </h2>
</div>


<p>Ghost's GitHub repository contains the un-built source code for Ghost. If you're looking for the already
built release zips, you can get these from the <a href="https://github.com/TryGhost/Ghost/releases">release page</a> on
GitHub or from <a href='https://ghost.org/download'>https://ghost.org/download</a>. These zip files are created using the <a href="#release">grunt release</a>
task.</p>

<p>If you want to work on Ghost core, or you want to use the source files from GitHub, then you have to build
the Ghost assets in order to make them work.</p>

<p>There are a number of grunt tasks available to help with this. Firstly after fetching an updated version of
the Ghost codebase, after running <code>npm install</code>, you will need to run <a href="#init%20assets">grunt init</a>.</p>

<p>For production blogs you will need to run <a href="#production%20assets">grunt prod</a>.</p>

<p>For updating assets during development, the tasks <a href="#default%20asset%20build">grunt</a> and
<a href="#live%20reload">grunt dev</a> are available.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="init%20assets">
  <h3>
    <a href="#init%20assets" name="init%20assets" class="pilcrow">&#182;</a>
    Init assets
  </h3>
</div>


<p><code>grunt init</code> - will run an initial asset build for you</p>

<p>Grunt init runs <code>bower install</code> as well as the standard asset build tasks which occur when you run just
<code>grunt</code>. This fetches the latest client side dependencies, and moves them into their proper homes.</p>

<p>This task is very important, and should always be run and when fetching down an updated code base just after
running <code>npm install</code>.</p>

<p><code>bower</code> does have some quirks, such as not running as root. If you have problems please try running
<code>grunt init --verbose</code> to see if there are any errors.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="s1">&#39;Prepare the project for development&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;shell:ember:init&#39;</span><span class="p">,</span> <span class="s1">&#39;shell:bower&#39;</span><span class="p">,</span> <span class="s1">&#39;update_submodules&#39;</span><span class="p">,</span> <span class="s1">&#39;assets&#39;</span><span class="p">,</span> <span class="s1">&#39;default&#39;</span><span class="p">]);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="basic%20asset%20building">
  <h3>
    <a href="#basic%20asset%20building" name="basic%20asset%20building" class="pilcrow">&#182;</a>
    Basic Asset Building
  </h3>
</div>


<p>Builds and moves necessary client assets. Prod additionally builds the ember app.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;assets&#39;</span><span class="p">,</span> <span class="s1">&#39;Basic asset building &amp; moving&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;clean:tmp&#39;</span><span class="p">,</span> <span class="s1">&#39;buildAboutPage&#39;</span><span class="p">]);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="default%20asset%20build">
  <h3>
    <a href="#default%20asset%20build" name="default%20asset%20build" class="pilcrow">&#182;</a>
    Default asset build
  </h3>
</div>


<p><code>grunt</code> - default grunt task</p>

<p>Build assets and dev version of the admin app.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">,</span> <span class="s1">&#39;Build JS &amp; templates for development&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;shell:ember:dev&#39;</span><span class="p">]);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="production%20assets">
  <h3>
    <a href="#production%20assets" name="production%20assets" class="pilcrow">&#182;</a>
    Production assets
  </h3>
</div>


<p><code>grunt prod</code> - will build the minified assets used in production.</p>

<p>It is otherwise the same as running <code>grunt</code>, but is only used when running Ghost in the <code>production</code> env.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;prod&#39;</span><span class="p">,</span> <span class="s1">&#39;Build JS &amp; templates for production&#39;</span><span class="p">,</span>
            <span class="p">[</span><span class="s1">&#39;shell:ember:prod&#39;</span><span class="p">,</span> <span class="s1">&#39;uglify:prod&#39;</span><span class="p">,</span> <span class="s1">&#39;master-warn&#39;</span><span class="p">]);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="live%20reload">
  <h3>
    <a href="#live%20reload" name="live%20reload" class="pilcrow">&#182;</a>
    Live reload
  </h3>
</div>


<p><code>grunt dev</code> - build assets on the fly whilst developing</p>

<p>If you want Ghost to live reload for you whilst you're developing, you can do this by running <code>grunt dev</code>.
This works hand-in-hand with the <a href="http://livereload.com/">livereload</a> chrome extension.</p>

<p><code>grunt dev</code> manages starting an express server and restarting the server whenever core files change (which
require a server restart for the changes to take effect) and also manage reloading the browser whenever
frontend code changes.</p>

<p>Note that the current implementation of watch only works with casper, not other themes.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;dev&#39;</span><span class="p">,</span> <span class="s1">&#39;Dev Mode; watch files and restart server on changes&#39;</span><span class="p">,</span>
           <span class="p">[</span><span class="s1">&#39;bgShell:ember&#39;</span><span class="p">,</span> <span class="s1">&#39;express:dev&#39;</span><span class="p">,</span> <span class="s1">&#39;watch&#39;</span><span class="p">]);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="release">
  <h3>
    <a href="#release" name="release" class="pilcrow">&#182;</a>
    Release
  </h3>
</div>


<p>Run <code>grunt release</code> to create a Ghost release zip file.
Uses the files specified by <code>.npmignore</code> to know what should and should not be included.
Runs the asset generation tasks for both development and production so that the release can be used in
either environment, and packages all the files up into a zip.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">grunt</span><span class="p">.</span><span class="nx">registerTask</span><span class="p">(</span><span class="s1">&#39;release&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Release task - creates a final built zip\n&#39;</span> <span class="o">+</span>
            <span class="s1">&#39; - Do our standard build steps \n&#39;</span> <span class="o">+</span>
            <span class="s1">&#39; - Copy files to release-folder/#/#{version} directory\n&#39;</span> <span class="o">+</span>
            <span class="s1">&#39; - Clean out unnecessary files (travis, .git*, etc)\n&#39;</span> <span class="o">+</span>
            <span class="s1">&#39; - Zip files in release-folder to dist-folder/#{version} directory&#39;</span><span class="p">,</span>
            <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">grunt</span><span class="p">.</span><span class="nx">config</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;copy.release&#39;</span><span class="p">,</span> <span class="p">{</span>
                    <span class="nx">expand</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="build%20file%20patterns">
  <h4>
    <a href="#build%20file%20patterns" name="build%20file%20patterns" class="pilcrow">&#182;</a>
    Build File Patterns
  </h4>
</div>


<p>A list of files and patterns to include when creating a release zip.
This is read from the <code>.npmignore</code> file and all patterns are inverted as the <code>.npmignore</code>
file defines what to ignore, whereas we want to define what to include.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                    <span class="nx">src</span><span class="o">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;.npmignore&#39;</span><span class="p">,</span> <span class="s1">&#39;utf8&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">).</span><span class="nx">filter</span><span class="p">(</span><span class="nb">Boolean</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">pattern</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="nx">pattern</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">===</span> <span class="s1">&#39;!&#39;</span> <span class="o">?</span> <span class="nx">pattern</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">:</span> <span class="s1">&#39;!&#39;</span> <span class="o">+</span> <span class="nx">pattern</span><span class="p">;</span>
                    <span class="p">}),</span>
                    <span class="nx">dest</span><span class="o">:</span> <span class="s1">&#39;&lt;%= paths.releaseBuild %&gt;/&#39;</span>
                <span class="p">});</span>

                <span class="nx">grunt</span><span class="p">.</span><span class="nx">task</span><span class="p">.</span><span class="nx">run</span><span class="p">([</span><span class="s1">&#39;init&#39;</span><span class="p">,</span> <span class="s1">&#39;prod&#39;</span><span class="p">,</span> <span class="s1">&#39;clean:release&#39;</span><span class="p">,</span>  <span class="s1">&#39;shell:dedupe&#39;</span><span class="p">,</span> <span class="s1">&#39;shell:shrinkwrap&#39;</span><span class="p">,</span> <span class="s1">&#39;copy:release&#39;</span><span class="p">,</span> <span class="s1">&#39;compress:release&#39;</span><span class="p">]);</span>
            <span class="p">}</span>
        <span class="p">);</span>
    <span class="p">};</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">configureGrunt</span><span class="p">;</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
